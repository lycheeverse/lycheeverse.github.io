---
import { Code } from "@astrojs/starlight/components";
import { getEntry, render } from 'astro:content';

export type Props = Parameters<typeof Code>[0] & {
  /**
   * Function applied to (possibly) produce a marker for each line
   * in the code block.
   */
  markerFn?: (line: string) => string | null;
};

const { markerFn = () => null, code } = Astro.props;

const markers = code.split("\n").flatMap((line: string, i: number) => {
  const label = markerFn(line);
  return label ? [{ range: `${i + 1}`, label }] : [];
});

// const { Content, headings } = await render(`
// ffdsa
// ${markers.map(x => "# " + x.label.replace('#', '') + "\n\n").join("\n")}
// `);
const entry = await getEntry('docs', 'how-it-works');
const { Content, headings } = await render(entry);
---
<Content />
<Code code={code} mark={markers}></Code>
