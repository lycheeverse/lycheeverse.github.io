---
import { Code } from "@astrojs/starlight/components";

export interface Props extends Parameters<Code> {
  /**
   * Function applied to (possibly) produce a marker for each line
   * in the code block.
   */
  markerFn?: (line: string) => string | null;
}

const { markerFn = () => null, code } = Astro.props;

const markers = code.split("\n").flatMap((line, i) => {
  const label = markerFn(line);
  return label ? [{ range: `${i + 1}`, label }] : [];
});
---
<Code code={code} mark={markers}></Code>
