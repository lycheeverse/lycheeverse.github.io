---
import { Code } from "@astrojs/starlight/components";
import type { CodeProps } from "astro-expressive-code/components/types";

export type Props = AstroExpressiveCodeOptions & {
  /**
   * Function applied to (possibly) produce a marker for each line
   * in the code block.
   */
  markerFn?: (line: string) => string | null;
};

const { markerFn = () => null, code } = Astro.props;

const markers = code.split("\n").flatMap((line: string, i: number) => {
  const label = markerFn(line);
  return label ? [{ range: `${i + 1}`, label }] : [];
});
---
<Code code={code} mark={markers}></Code>
